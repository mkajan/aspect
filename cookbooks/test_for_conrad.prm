### MAIN PARAMETERS


set CFL number                                 = 1.0
set Dimension                                  = 3
set Start time                                 = 0
set End time                                   = 0
set Use years in output instead of seconds     = true
set Resume computation                         = false
set Adiabatic surface temperature              = 1600.0
set Output directory                           = test_for_conrad/




### SOLVER PARAMETERS


set Max nonlinear iterations                   = 10
set Nonlinear solver scheme                    = iterated Advection and Stokes
set Nonlinear solver tolerance                 = 1e-5


subsection Solver parameters
  subsection Stokes solver parameters
    set GMRES solver restart length                     = 350   # default: 50
    set Linear solver tolerance                         = 1e-5  # default: 1e-7
  end
end


subsection Discretization
  set Stokes velocity polynomial degree            = 2
  set Temperature polynomial degree                = 2
  set Use locally conservative discretization      = false

  subsection Stabilization parameters
    set Use artificial viscosity smoothing                 = false
    set alpha                                              = 2
    set beta                                               = 0.117  # default: 0.078
    set cR                                                 = 0.5  # default: 0.33
  end
end




### BOUNDARY CONDITIONS


subsection Boundary velocity model
  set Prescribed velocity boundary indicators = 
  set Tangential velocity boundary indicators = inner, outer  # free-slip
  set Zero velocity boundary indicators       = #outer  # switch 'outer' to here for no-slip surface
end


subsection Nullspace removal
  set Remove nullspace = # net rotation  # shouldn't be required with laterally variable viscosity
end




### TEMPERATURE CONDITIONS


subsection Boundary temperature model
  set List of model names = #spherical constant
  set Fixed temperature boundary indicators   = outer, inner

#  subsection Spherical constant
#    set Inner temperature = 3444
#    set Outer temperature = 300
#  end
end


subsection Heating model
  set List of model names = adiabatic heating, shear heating

  subsection Adiabatic heating
    set Use simplified adiabatic heating = true
  end
end



subsection Initial temperature model
  set List of model names     = S40RTS perturbation
  set List of model operators = add

  subsection S40RTS perturbation
    set Remove degree 0 from perturbation = true
    set Vs to density scaling = 0.15
    set Thermal expansion coefficient in initial temperature scaling = 2e-5
  end
end




### PHYSICAL MODEL


subsection Formulation
  set Enable elasticity            = false
  set Formulation                  = anelastic liquid approximation
end


subsection Geometry model
  set Model name = spherical shell

  subsection Spherical shell
    set Inner radius              = 3480000
    set Opening angle             = 360
    set Outer radius              = 6368000
  end
end


subsection Gravity model
  set Model name = ascii data
end


subsection Material model
  set Material averaging = harmonic average # none
  set Model name         = Steinberger

  # I have a custom material model that takes in viscosity as a 3D ASCII input,
  # but let's use Steinberger with temperature-dependent LVVs for simplicity
  subsection Steinberger model
    set Use lateral average temperature for viscosity = false
    set Minimum viscosity = 1e18
    set Maximum viscosity = 1e24
    set Maximum lateral viscosity variation = 1e4
  end
end




### MESH 


subsection Mesh refinement
  set Initial global refinement                = 3
  set Initial adaptive refinement              = 0
  set Time steps between mesh refinement       = 0

  set Skip solvers on initial refinement                  = true
  set Skip setup initial conditions on initial refinement = false
  set Coarsening fraction                      = 1.0  # default: 0.05
  set Refinement fraction                      = 0.0  # default: 0.3
  set Minimum refinement level                 = 3
  set Strategy                                 = minimum refinement function

  subsection Minimum refinement function
    set Variable names = depth, phi, theta
    set Function expression = if(depth>200e3,5,6)
  end
end




### POSTPROCESSING


subsection Postprocess
  set List of postprocessors                     = Stokes residual, visualization, velocity statistics, basic statistics, depth average, dynamic topography

  subsection Depth average
    set List of output variables      = temperature, viscosity
    set Number of zones               = 150
    set Output format                 = txt
    set Time between graphical output = 0
  end

 subsection Dynamic topography
   set Density above  = 1000  # water-loaded  # default: 0
   set Density below  = 9900
   set Output bottom  = true
   set Output surface = true
  end

  subsection Visualization
    set List of output variables            = density, dynamic topography, viscosity, stress, strain rate, error indicator, nonadiabatic pressure
    set Time between graphical output       = 0
    set Write in background thread          = true
    set Output format                       = vtu
    set Interpolate output                  = true
    set Write higher order output           = true
  end
end

